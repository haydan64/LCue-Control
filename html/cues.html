<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCue Cues</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="nav-styles.css">
    <link rel="stylesheet" href="fontawesome-free-6.6.0-web/css/all.min.css">
    <script src="displayNav.js"></script>
</head>

<body>
    <!-- Main Sidebar Navigation -->
    <div class="nav" id="nav">
        <ul>
            <li><a href="./cues.html"><i class="fas fa-forward"></i> <span>Cues</span></a></li>
            <li><a href="./devices.html"><i class="fas fa-desktop"></i> <span>Devices</span></a></li>
            <li><a href="./displays.html"><i class="fas fa-tv"></i> <span>Displays</span></a></li>
            <li><a href="./serverConfig.html"><i class="fas fa-server"></i> <span>Server Config</span></a></li>
            <li><a href="./controlConfig.html"><i class="fas fa-cogs"></i> <span>Control Config</span></a></li>
            <li><a href="./connectRemotely.html"><i class="fas fa-wifi"></i> <span>Connect Remotely</span></a>
            </li>
        </ul>
    </div>


    <!--Main Content-->
    <div class="main">
        <!--Top bar, including Next Cue, and Previous Cue buttons. And Triggers.-->
        <div id="topBar" class="top-bar">
            <!--Cue Actions-->
            <div class="cue-actions">
                <button class="prev-cue-button" id="nextCueButton">Prev</button>
                <button class="next-cue-button" id="prevCueButton">Next</button>
            </div>
            <!--Triggers-->
            <div id="triggerList" class="triggerList"></div>
        </div>

        <!--Cue list-->
        <div class="cue-list" id="cueList"></div>
        <!--Cue list options-->
        <div class="cue-list-options" id="cueListOptions">
            <input type=button value="New Cue" id="newCueButton">
        </div>
    </div>


    <!--Action Modal-->
    <dialog class="modal" id="actionModal">
        <h2 id="actionModalHeader">Create Action</h2>
        <label for="actionType">Action Type:</label>
        <select id="actionType">
            <option value="">Select...</option>
            <option value="trigger">Trigger</option>
            <option value="display">Display</option>
            <option value="eos">Eos Control</option>
            <option value="wled">WLED</option>
            <option value="osc">OSC</option>
            <option value="dmx">DMX</option>
        </select>
        <!--Options-->
        <div>
            <!--Trigger Options-->
            <div id="triggerOptions">
                <label for="triggerName">Trigger Name:</label>
                <input type="text" id="triggerName">
            </div>

            <!--Display Options-->
            <div id="displayOptions">
                <!--Select Display-->
                <label for="selectDisplay">Select Display:</label>
                <select id="selectDisplay"></select>

                <!--Show File or Play Playlist-->
                <label for="selectDisplayAction">Action Type:</label>
                <select id="selectDisplayAction">
                    <option value="file">File</option>
                    <option value="playlist">Playlist</option>
                </select>

                <!--File Actions-->
                <div id="displayFileActions">
                    <!--Select file to display-->
                    <label for="selectDisplayFile">File:</label>
                    <select id="selectDisplayFile"></select>

                    <!--Show File or Play Playlist-->
                    <label for="selectDisplayFileAction">File Action:</label>
                    <select id="selectDisplayFileAction">
                        <option value="loop">Loop Video</option>
                        <option value="pause">Pause At End</option>
                    </select>
                </div>

                <!--Playlist Actions-->
                <div id="displayPlaylistActions">
                    <!--Select playlist to display-->
                    <label for="selectDisplayPlaylist">Playlist:</label>
                    <select id="selectDisplayPlaylist"></select>

                    <!--
                    Weather the playlist begin at the file where it was last shown
                    (If checked, displayPlaylistStartAtFile should become unavailable)
                    -->
                    <label class="custom-checkbox" for="displayPlaylistResume">
                        <span class="checkbox-label">Resume Playlist:</span>
                        <input class="checkbox" type="checkbox" id="displayPlaylistResume">
                        <span class="checkmark"></span>
                    </label>

                    <!--Select the file the playlist should show first-->
                    <label for="displayPlaylistStartAtFile" value="1">Begin With File:</label>
                    <input type="number" id="displayPlaylistStartAtFile"></input>

                    <!--Weather the playlist should loop once it reaches the end-->
                    <label class="custom-checkbox" for="displayPlaylistRepeat">
                        <span class="checkbox-label">Loop Playlist:</span>
                        <input class="checkbox" type="checkbox" id="displayPlaylistRepeat">
                        <span class="checkmark"></span>
                    </label>

                    <!--Weather the playlist should auto-advance to the next file.-->
                    <label class="custom-checkbox" for="displayPlaylistAutoAdvance">
                        <span class="checkbox-label">Auto-Advance:</span>
                        <input class="checkbox" type="checkbox" id="displayPlaylistAutoAdvance">
                        <span class="checkmark"></span>
                    </label>
                </div>

                <!--Select how to transition to file/playlist.-->
                <label for="displayTransition">Transition:</label>
                <select id="selectDisplayTransition">
                    <option value="cut">Cut</option>
                    <option value="fade">Fade</option>
                    <option value="slideUp">Slide Up</option>
                    <option value="slideDown">Slide Down</option>
                    <option value="slideLeft">Slide Left</option>
                    <option value="slideRight">Slide Right</option>
                    <option value="wipeUp">Wipe Up</option>
                    <option value="wipeDown">Wipe Down</option>
                    <option value="wipeLeft">Wipe Left</option>
                    <option value="wipeRight">Wipe Right</option>
                    <option value="dipToBlack">Dip To Black</option>
                    <option value="dipToWhite">Dip To White</option>
                    <option value="iris">Iris</option>
                    <option value="zoomIn">Zoom In</option>
                </select>

                <!--Select durration of transition-->
                <label for="displayTransitionDurration">Transition Durration:</label>
                <input type="number" id="displayTransitionDurration" min="0" max="60" value="1">
                <input type="range" id="displayTransitionRange" min="0" max="8" step="0.1" value="1">
            </div>

            <!--EOS Options-->
            <div id="eosOptions">
                <!--Select EOS Device-->
                <label for="selectEOS">Select EOS Device:</label>
                <select id="selectEOS"></select>

                <!--Select EOS Action-->
                <select id="selectEOSAction">
                    <option value="nextCue">Next Cue</option>
                    <option value="gotoCue">Goto Cue</option>
                    <option value="prevCue">Previous Cue</option>
                    <option value="submaster">Submaster</option>
                    <option value="recallPreset">Recall Preset</option>
                    <option value="buttonPress">Press Button</option>
                    <option value="OSC">Custom OSC Command</option>
                </select>

                <!--Next Cue-->
                <div id="EOSNextCue">

                </div>

                <!--Goto Cue-->
                <div id="EOSGotoCue">
                    <!--Use Current Open Cue List?-->
                    <label class="custom-checkbox" for="EOSGotoCueCurrentCuelist">
                        <span class="checkbox-label">Use Current Cuelist:</span>
                        <input class="create-action-checkbox" type="checkbox" id="EOSGotoCueCurrentCuelist" checked>
                        <span class="checkmark"></span>
                    </label>

                    <!--Select Cue List (if checked)-->
                    <div id="selectEOSGotoCueCuelist">
                        <label for="EOSGotoCueCuelistNumber">Select Cuelist</label>
                        <input type="number" id="EOSGotoCueCuelistNumber" value="1">
                    </div>

                    <!--Select Cue-->
                    <label for="EOSGotoCueCueNumber">Select Cue</label>
                    <input type="number" id="EOSGotoCueCueNumber" value="1">
                </div>

                <!--Prev Cue-->
                <div id="EOSPrevCue">

                </div>

                <!--Submaster-->
                <div id="EOSSubmaster">
                    <!--Select Submaster-->
                    <label for="EOSSubmasterNumber">Select Submaster</label>
                    <input type="number" id="EOSSubmasterNumber" value="1">

                    <!--Select Submaster Action-->
                    <label for="selectSubmasterAction">Action:</label>
                    <select id="selectSubmasterAction">
                        <option value="out">Out</option>
                        <option value="home">Home</option>
                        <option value="level">Level</option>
                        <option value="full">Full</option>
                        <option value="min">Min</option>
                        <option value="max">Max</option>
                        <option value="fire">Fire</option>
                    </select>
                </div>

                <!--Recall Preset-->
                <div id="EOSRecallPreset">
                    <!--Select Preset-->
                    <label for="EOSPresetNumber">Select Submaster</label>
                    <input type="number" id="EOSPresetNumber" value="1">
                </div>

                <!--Press Button-->
                <div id="EOSPressButton"></div>

                <!--Custom OSC Command-->
                <div id="EOSCustomOSC"></div>
            </div>

            <!--WLED Options-->
            <div id="wledOptions">
                <!--Select WLED Device-->
                <label for="selectWLED">Select WLED Device:</label>
                <select id="selectWLED"></select>

                <!--Select WLED Action-->
                <select id="selectWLEDAction">
                    <option value="on">Turn On</option>
                    <option value="off">Turn Off</option>
                    <option value="brightness">Set Brightness</option>
                    <option value="color">Set Color</option>
                    <option value="preset">Recall Preset</option>
                </select>

                <!--Set Brightness-->
                <div id="WLEDBrightness">
                    <label for="WLEDBrightnessNumber">Brightness:</label>
                    <input type="number" id="WLEDBrightnessNumber" min="0" max="100" value="100">
                    <input type="range" id="WLEDBrightnessRange" min="0" max="100" step="0.1" value="100">
                </div>
                <!--Set Color-->
                <div id="WLEDColor">
                    <label class="color-input" for="WLEDColorHex">
                        <span>Color:</span>
                        <input type="color" id="WLEDColorHex">
                    </label>
                </div>
                <!--Recall Preset-->
                <div id="WLEDPreset">
                    <label for="WLEDPresetNumber">Preset:</label>
                    <input type="number" id="WLEDPresetNumber">
                </div>

            </div>

            <!--OSC Options-->
            <div id="oscOptions">

            </div>

            <!--DMX Options-->
            <div id="dmxOptions">

            </div>
        </div>
        <button id="editActionButton" class="modal-close-btn hidden">Save Action</button>
        <button id="createActionButton" class="modal-close-btn">Create Action</button>
        <button id="closeActionModal" class="modal-close-btn">Close</button>
    </dialog>

    <dialog class="modal" id="cueNameModal">
        <h2 id="cueNameModalHeader">Move Cue To</h2>

        <!--The position for which to move the cue to-->
        <label for="cueNewName" value="1">Name:</label>
        <input type="text" id="cueNewName"></input>

        <button id="cueNameModalSubmit" class="modal-close-btn">Name</button>
        <button id="cueNameModalCancel" class="modal-close-btn">Cancel</button>
    </dialog>
    <dialog class="modal" id="cueMoveToModal">
        <h2 id="cueMoveToModalHeader">Move Cue To</h2>

        <!--The position for which to move the cue to-->
        <label for="cueMoveToNewPosition" value="1">New Position:</label>
        <input type="number" id="cueMoveToNewPosition"></input>

        <button id="cueMoveToModalSubmit" class="modal-close-btn">Move</button>
        <button id="cueMoveToModalCancel" class="modal-close-btn">Cancel</button>
    </dialog>
    <div id="toast" class="toast">
        <h2 id="toastHeader"></h2>
        <p id="toastBody"></p>
    </div>

    <script>
        const Elms = {
            nav: document.getElementById("nav"),
            triggerList: document.getElementById("triggerList"),
            topBar: document.getElementById("topBar"),
            nextCueButton: document.getElementById("nextCueButton"),
            prevCueButton: document.getElementById("prevCueButton"),
            cueList: document.getElementById("cueList"),
            cue1: document.getElementById("cue1"),
            actionModal: document.getElementById("actionModal"),
            actionModalHeader: document.getElementById("actionModalHeader"),
            actionType: document.getElementById("actionType"),
            triggerOptions: document.getElementById("triggerOptions"),
            triggerName: document.getElementById("triggerName"),
            displayOptions: document.getElementById("displayOptions"),
            selectDisplay: document.getElementById("selectDisplay"),
            selectDisplayAction: document.getElementById("selectDisplayAction"),
            displayFileActions: document.getElementById("displayFileActions"),
            selectDisplayFile: document.getElementById("selectDisplayFile"),
            selectDisplayFileAction: document.getElementById("selectDisplayFileAction"),
            displayPlaylistActions: document.getElementById("displayPlaylistActions"),
            selectDisplayPlaylist: document.getElementById("selectDisplayPlaylist"),
            displayPlaylistResume: document.getElementById("displayPlaylistResume"),
            displayPlaylistStartAtFile: document.getElementById("displayPlaylistStartAtFile"),
            displayPlaylistRepeat: document.getElementById("displayPlaylistRepeat"),
            displayPlaylistAutoAdvance: document.getElementById("displayPlaylistAutoAdvance"),
            selectDisplayTransition: document.getElementById("selectDisplayTransition"),
            displayTransitionDurration: document.getElementById("displayTransitionDurration"),
            displayTransitionRange: document.getElementById("displayTransitionRange"),
            eosOptions: document.getElementById("eosOptions"),
            selectEOS: document.getElementById("selectEOS"),
            selectEOSAction: document.getElementById("selectEOSAction"),
            EOSNextCue: document.getElementById("EOSNextCue"),
            EOSGotoCue: document.getElementById("EOSGotoCue"),
            EOSGotoCueCurrentCuelist: document.getElementById("EOSGotoCueCurrentCuelist"),
            selectEOSGotoCueCuelist: document.getElementById("selectEOSGotoCueCuelist"),
            EOSGotoCueCuelistNumber: document.getElementById("EOSGotoCueCuelistNumber"),
            EOSGotoCueCueNumber: document.getElementById("EOSGotoCueCueNumber"),
            EOSPrevCue: document.getElementById("EOSPrevCue"),
            EOSSubmaster: document.getElementById("EOSSubmaster"),
            EOSSubmasterNumber: document.getElementById("EOSSubmasterNumber"),
            selectSubmasterAction: document.getElementById("selectSubmasterAction"),
            EOSRecallPreset: document.getElementById("EOSRecallPreset"),
            EOSPresetNumber: document.getElementById("EOSPresetNumber"),
            EOSPressButton: document.getElementById("EOSPressButton"),
            EOSCustomOSC: document.getElementById("EOSCustomOSC"),
            wledOptions: document.getElementById("wledOptions"),
            selectWLED: document.getElementById("selectWLED"),
            selectWLEDAction: document.getElementById("selectWLEDAction"),
            WLEDBrightness: document.getElementById("WLEDBrightness"),
            WLEDBrightnessNumber: document.getElementById("WLEDBrightnessNumber"),
            WLEDBrightnessRange: document.getElementById("WLEDBrightnessRange"),
            WLEDColor: document.getElementById("WLEDColor"),
            WLEDColorHex: document.getElementById("WLEDColorHex"),
            WLEDPreset: document.getElementById("WLEDPreset"),
            WLEDPresetNumber: document.getElementById("WLEDPresetNumber"),
            oscOptions: document.getElementById("oscOptions"),
            dmxOptions: document.getElementById("dmxOptions"),
            createActionButton: document.getElementById("createActionButton"),
            closeActionModal: document.getElementById("closeActionModal"),
            newCueButton: document.getElementById("newCueButton"),
            cueMoveToModal: document.getElementById("cueMoveToModal"),
            cueMoveToModalHeader: document.getElementById("cueMoveToModalHeader"),
            cueMoveToNewPosition: document.getElementById("cueMoveToNewPosition"),
            cueMoveToModalSubmit: document.getElementById("cueMoveToModalSubmit"),
            cueMoveToModalCancel: document.getElementById("cueMoveToModalCancel"),
            cueNameModal: document.getElementById("cueNameModal"),
            cueNameModalHeader: document.getElementById("cueNameModalHeader"),
            cueNewName: document.getElementById("cueNewName"),
            cueNameModalSubmit: document.getElementById("cueNameModalSubmit"),
            cueNameModalCancel: document.getElementById("cueNameModalCancel"),
            editActionButton: document.getElementById("editActionButton"),
            toast: document.getElementById("toast"),
            toastHeader: document.getElementById("toastHeader"),
            toastBody: document.getElementById("toastBody")
        }

        function showToast(title, body) {
            Elms.toastHeader.textContent = title;
            Elms.toastBody.textContent = body;
            Elms.toast.classList.add("show");
            setTimeout(() => {
                Elms.toast.classList.remove("show");
            }, 3400);
        }

        Elms.topBar.addEventListener("contextmenu", (e)=>{
            e.preventDefault();
            api.emit("show-context-menu", { type: "triggerBox" });
        })
        placeCues();

        Elms.actionType.addEventListener("change", () => {
            /*
            trigger
            display
            eos
            wled
            osc
            dmx
            */
            switch (Elms.actionType.value) {
                case ("trigger"): {
                    Elms.triggerOptions.classList.remove("hidden");
                    Elms.displayOptions.classList.add("hidden");
                    Elms.eosOptions.classList.add("hidden");
                    Elms.wledOptions.classList.add("hidden");
                    Elms.oscOptions.classList.add("hidden");
                    Elms.dmxOptions.classList.add("hidden");
                    break;
                }
                case ("display"): {
                    Elms.triggerOptions.classList.add("hidden");
                    Elms.displayOptions.classList.remove("hidden");
                    Elms.eosOptions.classList.add("hidden");
                    Elms.wledOptions.classList.add("hidden");
                    Elms.oscOptions.classList.add("hidden");
                    Elms.dmxOptions.classList.add("hidden");

                    break;
                }
                case ("eos"): {
                    Elms.triggerOptions.classList.add("hidden");
                    Elms.displayOptions.classList.add("hidden");
                    Elms.eosOptions.classList.remove("hidden");
                    Elms.wledOptions.classList.add("hidden");
                    Elms.oscOptions.classList.add("hidden");
                    Elms.dmxOptions.classList.add("hidden");

                    break;
                }
                case ("wled"): {
                    Elms.triggerOptions.classList.add("hidden");
                    Elms.displayOptions.classList.add("hidden");
                    Elms.eosOptions.classList.add("hidden");
                    Elms.wledOptions.classList.remove("hidden");
                    Elms.oscOptions.classList.add("hidden");
                    Elms.dmxOptions.classList.add("hidden");

                    break;
                }
                case ("osc"): {
                    Elms.triggerOptions.classList.add("hidden");
                    Elms.displayOptions.classList.add("hidden");
                    Elms.eosOptions.classList.add("hidden");
                    Elms.wledOptions.classList.add("hidden");
                    Elms.oscOptions.classList.remove("hidden");
                    Elms.dmxOptions.classList.add("hidden");

                    break;
                }
                case ("dmx"): {
                    Elms.triggerOptions.classList.add("hidden");
                    Elms.displayOptions.classList.add("hidden");
                    Elms.eosOptions.classList.add("hidden");
                    Elms.wledOptions.classList.add("hidden");
                    Elms.oscOptions.classList.add("hidden");
                    Elms.dmxOptions.classList.remove("hidden");

                    break;
                }
            }
        })
        Elms.selectDisplay.addEventListener("change", () => {
            api.invoke("displays:getDisplay", Elms.selectDisplay.value).then((display) => {
                Elms.selectDisplayFile.textContent="";
                display.files.forEach((file) => {
                    const option = document.createElement("option");
                    option.value = file;
                    option.textContent = file;
                    Elms.selectDisplayFile.appendChild(option);
                })
            })
        })
        Elms.selectDisplayAction.addEventListener("change", () => {
            switch (Elms.selectDisplayAction.value) {
                case ("file"): {
                    Elms.displayFileActions.classList.remove("hidden");
                    Elms.displayPlaylistActions.classList.add("hidden");
                    break;
                }
                case ("playlist"): {
                    Elms.displayFileActions.classList.add("hidden");
                    Elms.displayPlaylistActions.classList.remove("hidden");
                    break;
                }
            }
        });
        Elms.displayPlaylistResume.addEventListener("change", () => {
            if (Elms.displayPlaylistResume.checked) {
                Elms.displayPlaylistStartAtFile.disabled = true;
            } else {
                Elms.displayPlaylistStartAtFile.disabled = false;
            }
        });
        Elms.selectEOSAction.addEventListener("change", () => {
            switch (Elms.selectEOSAction.value) {
                case ("nextCue"): {
                    Elms.EOSNextCue.classList.remove("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("gotoCue"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.remove("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("prevCue"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.remove("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("submaster"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.remove("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("recallPreset"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.remove("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("buttonPress"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.remove("hidden");
                    Elms.EOSCustomOSC.classList.add("hidden");
                    break;
                }
                case ("OSC"): {
                    Elms.EOSNextCue.classList.add("hidden");
                    Elms.EOSGotoCue.classList.add("hidden");
                    Elms.EOSPrevCue.classList.add("hidden");
                    Elms.EOSSubmaster.classList.add("hidden");
                    Elms.EOSRecallPreset.classList.add("hidden");
                    Elms.EOSPressButton.classList.add("hidden");
                    Elms.EOSCustomOSC.classList.remove("hidden");
                    break;
                }
            }
        })

        Elms.EOSGotoCueCurrentCuelist.addEventListener("change", () => {
            if (Elms.EOSGotoCueCurrentCuelist.checked) {
                Elms.selectEOSGotoCueCuelist.classList.add("hidden");
            } else {
                Elms.selectEOSGotoCueCuelist.classList.remove("hidden");
            }
        })

        Elms.selectWLEDAction.addEventListener("change", () => {
            switch (Elms.selectWLEDAction.value) {
                case ("on"): {
                    Elms.WLEDBrightness.classList.add("hidden");
                    Elms.WLEDColor.classList.add("hidden");
                    Elms.WLEDPreset.classList.add("hidden");
                    break;
                }
                case ("off"): {
                    Elms.WLEDBrightness.classList.add("hidden");
                    Elms.WLEDColor.classList.add("hidden");
                    Elms.WLEDPreset.classList.add("hidden");
                    break;
                }
                case ("brightness"): {
                    Elms.WLEDBrightness.classList.remove("hidden");
                    Elms.WLEDColor.classList.add("hidden");
                    Elms.WLEDPreset.classList.add("hidden");
                    break;
                }
                case ("color"): {
                    Elms.WLEDBrightness.classList.add("hidden");
                    Elms.WLEDColor.classList.remove("hidden");
                    Elms.WLEDPreset.classList.add("hidden");
                    break;
                }
                case ("preset"): {
                    Elms.WLEDBrightness.classList.add("hidden");
                    Elms.WLEDColor.classList.add("hidden");
                    Elms.WLEDPreset.classList.remove("hidden");
                    break;
                }
            }
        });

        let createActionModal = null;
        function openCreateActionModal() {
            Elms.actionModalHeader.textContent = "Create Action";
            populateActionModal({//default action
                type: "trigger",
                trigger: {
                    id: "",
                },
                display: {
                    id: "",
                    action: "file",
                    file: "",
                    fileAction: "loop",
                    playlist: "",
                    resume: false,
                    startAt: 1,
                    repeat: true,
                    autoAdvance: true,
                    transition: "cut",
                    durration: 1
                },
                eos: {
                    id: "",
                    action: "gotoCue",
                    currentCuelist: true,
                    cuelist: 1,
                    cue: 1,
                    submaster: 1,
                    submasterAction: "home",
                    preset: 1
                },
                wled: {
                    id: "",
                    action: "on",
                    brightness: "100",
                    color: "#ff0000",
                    preset: 1
                }
            });
            Elms.createActionButton.classList.remove("hidden");
            Elms.editActionButton.classList.add("hidden");
            Elms.actionModal.showModal();
        }
        let editActionModal = null;
        function openEditActionModal(options) {
            Elms.actionModalHeader.textContent = "Edit Action";
            Elms.createActionButton.classList.add("hidden");
            Elms.editActionButton.classList.remove("hidden");
            populateActionModal(options);
            Elms.actionModal.showModal();
        }

        updateDevicesAndDisplays();
        function updateDevicesAndDisplays() {
            api.invoke("getDevicesAndDisplays").then((data) => {
                console.log("DISPLAYS", data.displays);
                console.log("DEVICES", data.devices);
                Elms.selectDisplay.textContent = "";
                data?.displays?.forEach(display => {
                    const option = document.createElement("option");
                    option.value = display.id;
                    option.textContent = display.name;
                    Elms.selectDisplay.appendChild(option);
                })
            })
        }

        function collectActionModal() {
            const options = {};
            options.type = Elms.actionType.value;

            options.trigger = {};
            options.trigger.id = Elms.triggerName.value;

            options.display = {};
            options.display.id = Elms.selectDisplay.value;
            options.display.action = Elms.selectDisplayAction.value;
            options.display.file = Elms.selectDisplayFile.value;
            options.display.fileAction = Elms.selectDisplayFileAction.value;
            options.display.playlist = Elms.selectDisplayPlaylist.value;
            options.display.resume = Elms.displayPlaylistResume.checked;
            options.display.startAt = Elms.displayPlaylistStartAtFile.value;
            options.display.repeat = Elms.displayPlaylistRepeat.checked;
            options.display.autoAdvance = Elms.displayPlaylistAutoAdvance.checked;
            options.display.transition = Elms.selectDisplayTransition.value;
            options.display.durration = Elms.displayTransitionDurration.value;

            options.eos = {};
            options.eos.id = Elms.selectEOS.value;
            options.eos.action = Elms.selectEOSAction.value;
            options.eos.currentCuelist = Elms.EOSGotoCueCurrentCuelist.checked;
            options.eos.cuelist = Elms.EOSGotoCueCuelistNumber.value;
            options.eos.cue = Elms.EOSGotoCueCueNumber.value;
            options.eos.submaster = Elms.EOSSubmasterNumber.value;
            options.eos.submasterAction = Elms.selectSubmasterAction.value;
            options.eos.preset = Elms.EOSPresetNumber.value;

            options.wled = {};
            options.wled.id = Elms.selectWLED.value;
            options.wled.action = Elms.selectWLEDAction.value;
            options.wled.brightness = Elms.WLEDBrightnessNumber.value;
            options.wled.color = Elms.WLEDColorHex.value;
            options.wled.preset = Elms.WLEDPresetNumber.value;

            options.osc = {};
            options.osc.id = null;
            options.osc.message = null;

            options.dmx = {};
            options.dmx.id = null;
            options.dmx.options = {};

            return options;
        }

        function populateActionModal(options) {
            if (options.type !== undefined) {
                Elms.actionType.value = options.type;
                triggerChange(Elms.actionType);
            }

            if (options.trigger && options.trigger.id !== undefined) {
                Elms.triggerName.value = options.trigger.id;
            }

            if (options.display) {
                if (options.display.id !== undefined) Elms.selectDisplay.value = options.display.id;
                triggerChange(Elms.selectDisplay);
                if (options.display.action !== undefined) Elms.selectDisplayAction.value = options.display.action;
                triggerChange(Elms.selectDisplayAction);
                if (options.display.file !== undefined) Elms.selectDisplayFile.value = options.display.file;
                if (options.display.fileAction !== undefined) Elms.selectDisplayFileAction.value = options.display.fileAction;
                if (options.display.playlist !== undefined) Elms.selectDisplayPlaylist.value = options.display.playlist;
                if (options.display.resume !== undefined) Elms.displayPlaylistResume.checked = options.display.resume;
                triggerChange(Elms.displayPlaylistResume);
                if (options.display.startAt !== undefined) Elms.displayPlaylistStartAtFile.value = options.display.startAt;
                if (options.display.repeat !== undefined) Elms.displayPlaylistRepeat.checked = options.display.repeat;
                if (options.display.autoAdvance !== undefined) Elms.displayPlaylistAutoAdvance.checked = options.display.autoAdvance;
                if (options.display.transition !== undefined) Elms.selectDisplayTransition.value = options.display.transition;
                if (options.display.durration !== undefined) Elms.displayTransitionDurration.value = options.display.durration;
            }

            if (options.eos) {
                if (options.eos.id !== undefined) Elms.selectEOS.value = options.eos.id;
                if (options.eos.action !== undefined) Elms.selectEOSAction.value = options.eos.action;
                triggerChange(Elms.selectEOSAction);
                if (options.eos.currentCuelist !== undefined) Elms.EOSGotoCueCurrentCuelist.checked = options.eos.currentCuelist;
                triggerChange(Elms.EOSGotoCueCurrentCuelist);
                if (options.eos.cuelist !== undefined) Elms.EOSGotoCueCuelistNumber.value = options.eos.cuelist;
                if (options.eos.cue !== undefined) Elms.EOSGotoCueCueNumber.value = options.eos.cue;
                if (options.eos.submaster !== undefined) Elms.EOSSubmasterNumber.value = options.eos.submaster;
                if (options.eos.submasterAction !== undefined) Elms.selectSubmasterAction.value = options.eos.submasterAction;
                if (options.eos.preset !== undefined) Elms.EOSPresetNumber.value = options.eos.preset;
            }

            if (options.wled) {
                if (options.wled.id !== undefined) Elms.selectWLED.value = options.wled.id;
                if (options.wled.action !== undefined) Elms.selectWLEDAction.value = options.wled.action;
                triggerChange(Elms.selectWLEDAction);
                if (options.wled.brightness !== undefined) Elms.WLEDBrightnessNumber.value = options.wled.brightness;
                if (options.wled.color !== undefined) Elms.WLEDColorHex.value = options.wled.color;
                if (options.wled.preset !== undefined) Elms.WLEDPresetNumber.value = options.wled.preset;
            }

            if (options.osc) {
                // Since osc.id and osc.message are set to null in the original code, no DOM elements are updated
            }

            if (options.dmx) {
                // Since dmx.id and dmx.options are set to null in the original code, no DOM elements are updated
            }
        }

        function placeCues() {
            api.invoke("cues:getCues").then((cues) => {
                Elms.cueList.textContent = "";
                cues.forEach((cue) => {
                    Elms.cueList.appendChild(createCueElm(cue));
                })
            })
        }

        function createCueElm(cue) {
            const cueElm = document.createElement("div");
            cueElm.id = "cue#" + cue.id;
            cueElm.classList.add("cue");

            const cueInfoElm = document.createElement("span");
            cueInfoElm.classList.add("cue-info");
            cueInfoElm.textContent = `${cue.position} - ${cue.name || ""}`;
            cueElm.appendChild(cueInfoElm);

            const cueActionsElm = document.createElement("div");
            cueActionsElm.classList.add("hidden");
            cueActionsElm.id = "cueA#" + cue.id;
            cueActionsElm.classList.add("actions");

            cue.actions.forEach(action => {
                if (!action) return;

                cueActionsElm.appendChild(createCueActionElm(cue.id, action));
            });
            cueElm.appendChild(cueActionsElm);


            cueElm.addEventListener("click", () => {
                cueActionsElm.classList.toggle("hidden");
            });
            cueElm.addEventListener("contextmenu", e => {
                //make sure clicked on element doesn't have the "action" class
                let element = e.target;
                while (element) {
                    if (element.classList.contains("action")) return;
                    element = element.parentElement;
                }
                e.preventDefault();
                api.emit("show-context-menu", { type: "cue", id: cue.id });
            });
            return cueElm;
        }
        function createCueActionElm(cueID, action) {
            const cueActionElm = document.createElement("div");
            cueActionElm.id = "action#" + action;
            cueActionElm.classList.add("action");

            const cueActionNameElm = document.createElement("span");
            cueActionNameElm.classList.add("action-name");
            cueActionElm.appendChild(cueActionNameElm);
            cueActionElm.addEventListener("contextmenu", e => {
                e.preventDefault();
                api.emit("show-context-menu", { type: "action", id: action, cueID: cueID });
            });
            api.invoke("actions:getAction", action).then((action) => {
                if (!action) return;
                filloutActionElm(cueActionElm, action.id, action.options)
            });

            return cueActionElm;
        }
        function filloutActionElm(cueActionElm, id, options) {
            let name = `${id} - ${options.type}`;
            switch (options.type) {
                case ("trigger"): {
                    name = `Trigger ${options.trigger.id}`
                    break;
                }
                case ("display"): {
                    name = `${({
                        "cut": "Cut",
                        "fade": "Fade",
                        "slideUp": "Slide Up",
                        "slideDown": "Slide Down",
                        "slideLeft": "Slide Left",
                        "slideRight": "Slide Right",
                        "wipeUp": "Wipe Up",
                        "wipeDown": "Wipe Down",
                        "wipeLeft": "Wipe Left",
                        "wipeRight": "Wipe Right",
                        "dipToBlack": "Dip To Black",
                        "dipToWhite": "Dip To White",
                        "Iris": "Iris",
                        "zoomIn": "Zoom In",
                        "rippleFade": "Ripple Fade",
                    })[options.display.transition]} To ${options.action === 'file' ?
                        `File ${options.display.file}` :
                        `Playlist ${options.playlist}`}`
                    break;
                }
                case ("eos"): {
                    switch (options.eos.action) {
                        case ("nextCue"): {
                            name = "EOS Next Cue";
                            break;
                        }
                        case ("gotoCue"): {
                            name = "EOS Goto Cue " + options.eos.cue;
                            break;
                        }
                        case ("prevCue"): {
                            name = "EOS Prev CUe";
                            break;
                        }
                        case ("submaster"): {
                            name = "EOS Submaster";
                            break;
                        }
                        case ("recallPreset"): {
                            name = "EOS Recall Preset";
                            break;
                        }
                        case ("buttonPress"): {
                            name = "EOS Press Button";
                            break;
                        }
                        case ("OSC"): {
                            name = "EOS Custom OSC Message";
                            break;
                        }
                    }
                }
            }
            cueActionElm.getElementsByClassName("action-name").item(0).textContent = name;
        }

        function triggerChange(elm) {
            elm.dispatchEvent(new Event("change"));
        }

        Elms.newCueButton.addEventListener("click", () => {
            api.emit("cues:createNew");
        });

        api.on("cues:addedCue", (cue, prevCue) => {
            if (prevCue) {
                let prevCueElm = document.getElementById("cue#" + prevCue);
                if (prevCueElm) {
                    prevCueElm.insertAdjacentElement('afterend', createCueElm(cue));
                } else {
                    placeCues();
                    return;
                }
            } else {
                placeCues();
            }
        })
        api.on("cues:deletedCue", (id) => {
            let cueElm = document.getElementById("cue#" + id);
            if (cueElm) cueElm.remove();
        })

        let cueNameModal = null;
        api.on("cuectx:name", (id, name, position) => {
            cueNameModal = id;
            Elms.cueNameModalHeader.textContent = `Name Cue ${position}`;
            Elms.cueNameModal.showModal();
        });
        Elms.cueNameModalSubmit.addEventListener("click", () => {
            Elms.cueNameModal.close();
            api.emit("cues:nameCue", cueNameModal, Elms.cueNewName.value);
        });
        Elms.cueNameModalCancel.addEventListener("click", () => {
            Elms.cueNameModal.close();
        });
        api.on("cues:cueNamed", (id, newName) => {
            placeCues();
        })

        let cueMoveToModal = null;
        api.on("cuectx:moveTo", (id, position) => {
            cueMoveToModal = id;
            Elms.cueMoveToModalHeader.textContent = `Reposition Cue ${position}`;
            Elms.cueMoveToModal.showModal();
        });
        Elms.cueMoveToModalSubmit.addEventListener("click", () => {
            Elms.cueMoveToModal.close();
            api.emit("cues:moveCue", cueMoveToModal, Elms.cueMoveToNewPosition.value);
        });
        Elms.cueMoveToModalCancel.addEventListener("click", () => {
            Elms.cueMoveToModal.close();
        });
        api.on("cues:alreadyCueAtPos", (id, newPosition) => {
            console.log("Couldn't Move Cue - There is already a cue at the postion.");
            showToast("Couldn't Move Cue.", "There is already a cue at that position!");
        });

        api.on("cues:cueMoved", (id, prevCue) => {
            placeCues();
        });

        api.on("cuectx:newAction", (id) => {
            createActionModal = id;
            openCreateActionModal();
        })
        Elms.createActionButton.addEventListener("click", () => {
            const options = collectActionModal();
            api.emit("cues:createAction", createActionModal, options);
            Elms.actionModal.close();
        })
        Elms.editActionButton.addEventListener("click", () => {
            const options = collectActionModal();
            api.emit("cues:editAction", createActionModal, options);
            Elms.actionModal.close();
        })
        Elms.closeActionModal.addEventListener("click", () => {
            Elms.actionModal.close();
        })
        api.on("cues:actionCreated", (id, action) => {
            let actionsElm = document.getElementById("cueA#" + id);
            if (actionsElm) {
                actionsElm.appendChild(createCueActionElm(id, action));
            } else {
                placeCues();
            }
        })

        api.on("actionctx:edit", (id, cueID, options) => {
            if (!options) return;
            createActionModal = id;
            openEditActionModal(options);
        });

        api.on("actions:actionEdited", (id, options) => {
            let actionElm = document.getElementById("action#" + id);
            if (actionElm) {
                filloutActionElm(actionElm, id, options);
            }
        })

        function displayTriggers() {

        }

    </script>
</body>

</html>